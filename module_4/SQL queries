Задание 4.1
База данных содержит список аэропортов практически всех крупных городов России. В большинстве городов есть только один аэропорт. Исключение составляет:
Moscow, Ulyanovsk

  SELECT city
    FROM dst_project.airports
GROUP BY city
  HAVING COUNT(airport_code) > 1
  
Задание 4.2
Вопрос 1. Таблица рейсов содержит всю информацию о прошлых, текущих и запланированных рейсах. Сколько всего статусов для рейсов определено в таблице?
6

SELECT COUNT(DISTINCT status)
  FROM dst_project.flights
 
Вопрос 2. Какое количество самолетов находятся в воздухе на момент среза в базе (статус рейса «самолёт уже вылетел и находится в воздухе»).
58

SELECT COUNT(flight_id)
  FROM dst_project.flights
 WHERE status = 'Departed'
 
Вопрос 3. Места определяют схему салона каждой модели. Сколько мест имеет самолет модели  (Boeing 777-300)?
402

SELECT COUNT(seat_no)
  FROM dst_project.seats
 WHERE aircraft_code = '773'
 
Вопрос 4. Сколько состоявшихся (фактических) рейсов было совершено между 1 апреля 2017 года и 1 сентября 2017 года?
74227

SELECT COUNT(flight_id)
  FROM dst_project.flights
 WHERE (actual_arrival BETWEEN '2017-04-01' AND '2017-09-01')
   AND (status = 'Arrived')
 
Задание 4.3
Вопрос 1. Сколько всего рейсов было отменено по данным базы?
437
  
SELECT COUNT(flight_id)
  FROM dst_project.flights
 WHERE status = 'Cancelled'
 
Вопрос 2. Сколько самолетов моделей типа Boeing, Sukhoi Superjet, Airbus находится в базе авиаперевозок?
Boeing:
3

Sukhoi Superjet:
1
 
Airbus:
3
 
SELECT COUNT(aircraft_code)
  FROM dst_project.aircrafts 
 WHERE model LIKE 'Boeing%'

Вопрос 3. В какой части (частях) света находится больше аэропортов?
Europe, Asia

SELECT COUNT(airport_code) 
  FROM dst_project.airports
 WHERE timezone LIKE 'Asia%'
UNION ALL
SELECT COUNT(airport_code)
  FROM dst_project.airports
 WHERE timezone LIKE 'Australia%'
UNION ALL
SELECT COUNT(airport_code)
  FROM dst_project.airports
 WHERE timezone LIKE 'Europe%'

Вопрос 4. У какого рейса была самая большая задержка прибытия за все время сбора данных? Введите id рейса (flight_id).
157571
 
SELECT flight_id
  FROM dst_project.flights
 WHERE (actual_arrival - scheduled_arrival) = (
                                               SELECT MAX(actual_arrival - scheduled_arrival)
                                                 FROM dst_project.flights
                                              )
 
Задание 4.4
Вопрос 1. Когда был запланирован самый первый вылет, сохраненный в базе данных?
14.08.2016

SELECT MIN(scheduled_departure)
  FROM dst_project.flights  

Вопрос 2. Сколько минут составляет запланированное время полета в самом длительном рейсе?
530

SELECT date_part('hour', MAX(scheduled_arrival - scheduled_departure)) * 60 + date_part('minute', MAX(scheduled_arrival - scheduled_departure))
  FROM dst_project.flights
 
Вопрос 3. Между какими аэропортами пролегает самый длительный по времени запланированный рейс?
DME - UUS

SELECT DISTINCT departure_airport, arrival_airport
  FROM dst_project.flights 
 WHERE scheduled_arrival - scheduled_departure = (
                                                 SELECT MAX(scheduled_arrival - scheduled_departure)
                                                 FROM dst_project.flights
                                                 )

Вопрос 4. Сколько составляет средняя дальность полета среди всех самолетов в минутах? Секунды округляются в меньшую сторону (отбрасываются до минут).
128
 
SELECT date_part('hour', AVG(scheduled_arrival - scheduled_departure)) * 60 + date_part('minute', AVG(scheduled_arrival - scheduled_departure))
  FROM dst_project.flights 
 
Задание 4.5
Вопрос 1. Мест какого класса у SU9 больше всего?
Economy

  SELECT fare_conditions, count(seat_no)
    FROM dst_project.seats 
   WHERE aircraft_code = 'SU9'                                      
GROUP BY fare_conditions

Вопрос 2. Какую самую минимальную стоимость составило бронирование за всю историю?
3400

SELECT MIN(total_amount)
  FROM dst_project.bookings 
 
Вопрос 3. Какой номер места был у пассажира с id = 4313 788533?
2A
 
SELECT seat_no
  FROM dst_project.boarding_passes b
  JOIN dst_project.tickets t
    ON b.ticket_no = t.ticket_no
 WHERE passenger_id = '4313 788533' 
 
Задание 5.1
Вопрос 1. Анапа — курортный город на юге России. Сколько рейсов прибыло в Анапу за 2017 год?
486

SELECT COUNT(flight_id)
  FROM dst_project.flights f
  JOIN dst_project.airports a
    ON f.arrival_airport = a.airport_code
 WHERE a.city = 'Anapa' and date_part('year', actual_arrival) = 2017
 
Вопрос 2. Сколько рейсов из Анапы вылетело зимой 2017 года?
127

SELECT COUNT(flight_id)
  FROM dst_project.flights f
  JOIN dst_project.airports a
    ON f.departure_airport = a.airport_code
 WHERE a.city = 'Anapa' 
   AND date_part('year', actual_departure) = 2017 
   AND date_part('month', actual_departure) IN (12,1,2)
 
Вопрос 3. Посчитайте количество отмененных рейсов из Анапы за все время.
1

SELECT COUNT(flight_id)
  FROM dst_project.flights f
  JOIN dst_project.airports a
    ON f.arrival_airport = a.airport_code
 WHERE a.city = 'Anapa' and f.status = 'Cancelled'
 
Вопрос 4. Сколько рейсов из Анапы не летают в Москву?
453

SELECT COUNT(flight_id)
  FROM dst_project.flights f
  JOIN dst_project.airports a
    ON f.arrival_airport = a.airport_code 
 WHERE a.city != 'Moscow' and f.departure_airport = 'AAQ'

Вопрос 5. Какая модель самолета летящего на рейсах из Анапы имеет больше всего мест?
Boeing 737-300

SELECT s.model, COUNT(m.seat_no)
  FROM dst_project.flights f
  JOIN dst_project.airports a
    ON f.departure_airport = a.airport_code 
  JOIN dst_project.aircrafts s
    ON f.aircraft_code = s.aircraft_code 
  JOIN dst_project.seats m
    ON s.aircraft_code = m.aircraft_code 
 WHERE a.city = 'Anapa' 
 GROUP BY s.model
 ORDER BY 2 desc
 LIMIT 1





















